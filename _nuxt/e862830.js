(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{397:function(e,t,r){var content=r(428);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("f2f1ecec",content,!0,{sourceMap:!1})},427:function(e,t,r){"use strict";r(397)},428:function(e,t,r){var n=r(18)(!1);n.push([e.i,'section[data-v-dcc71802]{width:100%;padding:6rem 0}h1[data-v-dcc71802]{font-family:"Barlow Condensed","Roboto",sans-serif;font-weight:700;text-align:center;font-size:4rem;line-height:1;margin:0 0 2rem}form[data-v-dcc71802]{width:600px;margin:auto}label[data-v-dcc71802]{display:block;margin-bottom:1rem;font-size:1.25rem;font-weight:700}input[type=file][data-v-dcc71802]::file-selector-button{background:#4096ff;color:#fff;transition:background .25s ease;border-radius:3px;border:none;padding:.75rem 1rem;text-align:center;font-weight:700;font-size:1rem;cursor:pointer;margin:0 1em 0 0}input[type=file][data-v-dcc71802]::file-selector-button:focus,input[type=file][data-v-dcc71802]::file-selector-button:hover{background:#0050b3}input[type=submit][data-v-dcc71802]{background:#ff5140;color:#fff;transition:background .25s ease;border-radius:3px;border:none;margin:0;padding:.75rem 1rem;text-align:center;font-weight:700;font-size:1rem;cursor:pointer}input[type=submit][data-v-dcc71802]:focus,input[type=submit][data-v-dcc71802]:hover{background:#e61400}select[data-v-dcc71802],textarea[data-v-dcc71802]{background-color:transparent;border:1px solid;border-radius:3px;box-shadow:none;padding:.5rem;font-size:1rem;font-family:"Roboto",sans-serif;width:100%}select[data-v-dcc71802]:focus,textarea[data-v-dcc71802]:focus{border-color:#e61400;outline:0}textarea[data-v-dcc71802]{min-height:6.5rem}em[data-v-dcc71802]{font-size:1em;font-weight:700;font-style:normal;color:#b00020}.form-group[data-v-dcc71802]{margin-bottom:2rem;width:100%}.grouped[data-v-dcc71802]{display:flex;flex-direction:row;grid-gap:1rem;gap:1rem;justify-content:space-between}',""]),e.exports=n},453:function(e,t,r){"use strict";r.r(t);r(57),r(30),r(11);var n=r(9);r(49),r(38),r(51),r(39),r(33),r(24),r(52),r(53),r(40),r(48);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var l={asyncData:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,d,f,v,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$axios,n=e.store,o=n.state.user,t.next=4,r.$get("/requests/types");case 4:return c=t.sent,t.next=7,r.$get("/collectivites/types");case 7:return l=t.sent,t.next=10,r.$get("/collectivites");case 10:return d=t.sent,t.next=13,r.$get("/collectivites/".concat(o.collectId));case 13:return f=t.sent,v=f.collectTypeId,m=f.collectId,t.abrupt("return",{collectTypeId:v,collectId:m,requestTypes:c,collectTypes:l,collects:d,user:o,token:n.getters.token});case 17:case"end":return t.stop()}}),t)})))()},data:function(){return{reqType:"",reqContent:"",attachements:[]}},head:function(){return{title:"Faire une Requête — eCollectivités"}},computed:{filteredCollects:function(){var e=this;return this.collects.filter((function(t){return t.collectTypeId===e.collectTypeId}))}},methods:{handleFileUpload:function(e){var t=e.target.files||e.dataTransfer.files;t.length&&(this.attachements=t)},submitRequest:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,data,n,c,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new FormData,data={reqType:e.reqType,reqContent:e.reqContent,collectId:e.collectId,userId:e.user.id},r.append("data",JSON.stringify(data)),n=o(e.attachements);try{for(n.s();!(c=n.n()).done;)l=c.value,r.append("attachements",l)}catch(e){n.e(e)}finally{n.f()}return t.prev=5,d={"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e.token)},t.next=9,e.$axios.$post("/requests",r,{headers:d});case 9:e.$toast.success("Requête envoyée avec succès!"),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),e.$toast.error("Une erreur est survenue. Veuillez réessayer plus tard.");case 15:case"end":return t.stop()}}),t,null,[[5,12]])})))()}}},d=(r(427),r(8)),component=Object(d.a)(l,(function(){var e=this,t=e._self._c;return t("section",[t("h1",[e._v("Faire une requête")]),e._v(" "),t("form",[e._m(0),e._v(" "),t("div",{staticClass:"grouped"},[t("div",{staticClass:"form-group"},[e._m(1),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.collectTypeId,expression:"collectTypeId"}],staticClass:"form-control",attrs:{id:"collect-type",required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.collectTypeId=t.target.multiple?r:r[0]}}},[t("option",{attrs:{value:""}},[e._v("--Choisir un type de collectivité--")]),e._v(" "),e._l(e.collectTypes,(function(r){return t("option",{key:r.collectTypeId,domProps:{value:r.collectTypeId}},[e._v("\n            "+e._s(r.collectTypeLabel)+"\n          ")])}))],2)]),e._v(" "),t("div",{staticClass:"form-group"},[e._m(2),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.collectId,expression:"collectId"}],staticClass:"form-control",attrs:{id:"collect",disabled:!e.collectTypeId,required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.collectId=t.target.multiple?r:r[0]}}},[t("option",{attrs:{value:""}},[e._v("--Choisir une collectivité--")]),e._v(" "),e._l(e.filteredCollects,(function(r){return t("option",{key:r.collectId,domProps:{value:r.collectId}},[e._v("\n            "+e._s(r.collectName)+"\n          ")])}))],2)])]),e._v(" "),t("div",{staticClass:"form-group"},[e._m(3),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.reqType,expression:"reqType"}],staticClass:"form-control",attrs:{id:"request-type",required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.reqType=t.target.multiple?r:r[0]}}},[t("option",{attrs:{value:""}},[e._v("--Choisir un type de requête--")]),e._v(" "),e._l(e.requestTypes,(function(r){return t("option",{key:r.reqTypeId,domProps:{value:r.reqTypeId}},[e._v("\n          "+e._s(r.reqTypeLabel)+"\n        ")])}))],2)]),e._v(" "),t("div",{staticClass:"form-group"},[e._m(4),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reqContent,expression:"reqContent"}],attrs:{id:"request-content",name:"request-content",cols:"50",rows:"10",placeholder:"Comment pouvons-nous vous aider ? Commencez par une brève introduction puis ajouter toutes les informations qui pourrait être utiles au traitement de votre requête...",required:""},domProps:{value:e.reqContent},on:{input:function(t){t.target.composing||(e.reqContent=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"attachements"}},[e._v("Fichiers")]),e._v(" "),t("input",{attrs:{id:"attachements",type:"file",name:"attachements",multiple:""},on:{change:e.handleFileUpload}})]),e._v(" "),t("input",{attrs:{type:"submit",value:"Envoyer"},on:{click:function(t){return t.preventDefault(),e.submitRequest()}}})])])}),[function(){var e=this,t=e._self._c;return t("p",[e._v("Champs obligatoire "),t("em",[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{attrs:{for:"collect-type"}},[e._v("Type de collectivité "),t("em",[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{attrs:{for:"collect"}},[e._v("Collectivité "),t("em",[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{attrs:{for:"request-type"}},[e._v("Type de requête "),t("em",[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{attrs:{for:"request-content"}},[e._v("Détails Requête "),t("em",[e._v("*")])])}],!1,null,"dcc71802",null);t.default=component.exports}}]);