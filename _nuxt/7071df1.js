(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{391:function(e,t,n){var content=n(416);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("7419a41a",content,!0,{sourceMap:!1})},415:function(e,t,n){"use strict";n(391)},416:function(e,t,n){var r=n(18)(!1);r.push([e.i,'section[data-v-195cfb34]{width:400px;margin:3rem auto}.form-group[data-v-195cfb34]{margin:1rem 0}label[data-v-195cfb34]{display:block;margin-bottom:.25rem;font-weight:700}select[data-v-195cfb34]{background-color:transparent;border:1px solid;border-radius:3px;box-shadow:none;padding:.5rem;font-size:1rem;font-family:"Roboto",sans-serif;width:100%}select[data-v-195cfb34]:focus{border-color:#e61400;outline:0}input[data-v-195cfb34]{width:100%;padding:.5rem;margin:.5rem 0 1rem;font-size:1rem;font-family:"Roboto",sans-serif}button[data-v-195cfb34],input[type=submit][data-v-195cfb34]{background:#ff5140;color:#fff;transition:background .25s ease;border-radius:3px;border:none;padding:.75rem 1rem;text-align:center;font-weight:700;font-size:1rem;cursor:pointer;margin:0 0 1rem;display:block;width:100%}button[data-v-195cfb34]:focus,button[data-v-195cfb34]:hover,input[type=submit][data-v-195cfb34]:focus,input[type=submit][data-v-195cfb34]:hover{background:#e61400}.login[data-v-195cfb34]{font-weight:700;margin-top:2rem;font-size:1rem;text-align:center}',""]),e.exports=r},444:function(e,t,n){"use strict";n.r(t);n(57),n(30),n(11),n(31),n(24),n(36),n(20),n(37);var r=n(15),o=n(9),c=(n(84),n(216),n(48),n(23));function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m={layout:"default-auth",middleware:function(e){var t=e.store,n=e.redirect;t.getters.isLoggedIn&&n("/")},asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$axios,t.next=3,n.$get("/collectivites/types");case 3:return r=t.sent,t.next=6,n.$get("/collectivites");case 6:return o=t.sent,t.abrupt("return",{collectTypes:r,collects:o});case 8:case"end":return t.stop()}}),t)})))()},data:function(){return{method:"email",email:"",password:"",phone:"",code:"",verifyToken:"",firstname:"",lastname:"",collectId:0,isCodeSended:!1,isLoginMethodProvided:!1}},head:function(){return{title:"S'inscrire — eCollectivités"}},methods:d(d({},Object(c.b)(["login","sendVerificationCode","checkVerificationCode"])),{},{next:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("email"!==e.method){t.next=4;break}e.isLoginMethodProvided=!0,t.next=19;break;case 4:if(!e.isCodeSended){t.next=17;break}return t.prev=5,t.next=8,e.checkVerificationCode({phone:e.phone,code:e.code});case 8:(n=t.sent.token)&&(e.verifyToken=n,e.isLoginMethodProvided=!0),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),window.alert("Code invalide");case 15:t.next=19;break;case 17:e.sendVerificationCode({phone:e.phone}),e.isCodeSended=!0;case 19:case"end":return t.stop()}}),t,null,[[5,12]])})))()},register:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"phone"!==e.method){t.next=8;break}return r={Authorization:"Bearer ".concat(e.verifyToken)},t.next=5,e.$axios.$post("/auth/signup",{method:e.method,phone:e.phone,firstname:e.firstname,lastname:e.lastname,collectId:e.collectId},{headers:r});case 5:n=t.sent,t.next=11;break;case 8:return t.next=10,e.$axios.$post("/auth/signup",{method:e.method,email:e.email,password:e.password,firstname:e.firstname,lastname:e.lastname,collectId:e.collectId});case 10:n=t.sent;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),e.$toast.error("Une erreur est survenue. Veuillez réessayer plus tard.");case 16:if(!n){t.next=28;break}return t.prev=17,t.next=20,e.login({method:e.method,email:e.email,password:e.password,phone:e.phone,code:e.code,verifyToken:e.verifyToken});case 20:!0===t.sent.loggedIn&&window.location.reload(),t.next=28;break;case 24:t.prev=24,t.t1=t.catch(17),e.$toast.error("Nous n'avons pas pu vous connecter automatiquement. Vous serez redirigé vers la page de connexion dans un instant..."),setTimeout((function(){this.$router.push("/connexion")}),3e3);case 28:case"end":return t.stop()}}),t,null,[[0,13],[17,24]])})))()},findCollectTypeLabel:function(e){return this.collectTypes.find((function(t){return t.collectTypeId===e})).collectTypeLabel},changeMethod:function(e){this.method=e,this.email="",this.password="",this.phone="",this.code="",this.verifyToken=""}})},v=(n(415),n(8)),component=Object(v.a)(m,(function(){var e=this,t=e._self._c;return t("section",[t("h1",[e._v("Créer un compte")]),e._v(" "),e.isLoginMethodProvided?t("div",[t("form",{on:{submit:function(t){return t.preventDefault(),e.register()}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"lastname"}},[e._v("Nom :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.lastname,expression:"lastname"}],attrs:{id:"lastname",type:"lastname",required:""},domProps:{value:e.lastname},on:{input:function(t){t.target.composing||(e.lastname=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"firstname"}},[e._v("Prénoms :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.firstname,expression:"firstname"}],attrs:{id:"firstname",type:"firstname",required:""},domProps:{value:e.firstname},on:{input:function(t){t.target.composing||(e.firstname=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"collect"}},[e._v("Collectivité")]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model.number",value:e.collectId,expression:"collectId",modifiers:{number:!0}}],attrs:{id:"collect",required:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(t){var n="_value"in t?t._value:t.value;return e._n(n)}));e.collectId=t.target.multiple?n:n[0]}}},[t("option",{attrs:{value:"0"}},[e._v("--Choisir une collectivité--")]),e._v(" "),e._l(e.collects,(function(n){return t("option",{key:n.collectId,domProps:{value:n.collectId}},[e._v("\n            "+e._s(n.collectName)+" ("+e._s(e.findCollectTypeLabel(n.collectTypeId))+")\n          ")])}))],2)]),e._v(" "),t("button",{staticClass:"login-btn",attrs:{type:"submit"}},[e._v("S'inscrire")])])]):t("div",["email"==e.method?t("form",{on:{submit:function(t){return t.preventDefault(),e.next()}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[e._v("Email :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],attrs:{id:"email",type:"email",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[e._v("Mot de passe :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{id:"password",type:"password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),t("button",{staticClass:"next-btn",attrs:{type:"submit"}},[e._v("Continuer")]),e._v(" "),t("button",{staticClass:"phone-login-btn",on:{click:function(t){return e.changeMethod("phone")}}},[e._v("Utiliser son téléphone")])]):t("form",{on:{submit:function(t){return t.preventDefault(),e.next()}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"phone"}},[e._v("Numéro de téléphone :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"}],attrs:{id:"phone",type:"tel",required:"",disabled:e.isCodeSended},domProps:{value:e.phone},on:{input:function(t){t.target.composing||(e.phone=t.target.value)}}})]),e._v(" "),e.isCodeSended?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"code"}},[e._v("Code de vérification :")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.code,expression:"code"}],attrs:{id:"code",required:""},domProps:{value:e.code},on:{input:function(t){t.target.composing||(e.code=t.target.value)}}})]):e._e(),e._v(" "),t("button",{staticClass:"login-btn",attrs:{type:"submit"}},[e._v("Continuer")]),e._v(" "),t("button",{staticClass:"phone-login-btn",on:{click:function(t){return e.changeMethod("email")}}},[e._v("Utiliser son email")])]),e._v(" "),t("nuxt-link",{staticClass:"login",attrs:{to:"/connexion"}},[e._v("Déjà un compte ? Se connecter")])],1)])}),[],!1,null,"195cfb34",null);t.default=component.exports}}]);