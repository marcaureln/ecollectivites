(window.webpackJsonp=window.webpackJsonp||[]).push([[25,8,9],{360:function(e,t,r){"use strict";var n=r(12),o=r(4),c=r(5),d=r(111),l=r(22),f=r(14),v=r(218),m=r(50),h=r(82),_=r(217),y=r(3),x=r(83).f,I=r(43).f,A=r(21).f,S=r(361),w=r(362).trim,k="Number",C=o.Number,R=C.prototype,N=o.TypeError,$=c("".slice),E=c("".charCodeAt),T=function(e){var t=_(e,"number");return"bigint"==typeof t?t:O(t)},O=function(e){var t,r,n,o,c,d,l,code,f=_(e,"number");if(h(f))throw N("Cannot convert a Symbol value to a number");if("string"==typeof f&&f.length>2)if(f=w(f),43===(t=E(f,0))||45===t){if(88===(r=E(f,2))||120===r)return NaN}else if(48===t){switch(E(f,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+f}for(d=(c=$(f,2)).length,l=0;l<d;l++)if((code=E(c,l))<48||code>o)return NaN;return parseInt(c,n)}return+f};if(d(k,!C(" 0o1")||!C("0b1")||C("+0x1"))){for(var D,F=function(e){var t=arguments.length<1?0:C(T(e)),r=this;return m(R,r)&&y((function(){S(r)}))?v(Object(t),r,F):t},j=n?x(C):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),L=0;j.length>L;L++)f(C,D=j[L])&&!f(F,D)&&A(F,D,I(C,D));F.prototype=R,R.constructor=F,l(o,k,F,{constructor:!0})}},361:function(e,t,r){var n=r(5);e.exports=n(1..valueOf)},362:function(e,t,r){var n=r(5),o=r(32),c=r(16),d=r(363),l=n("".replace),f="["+d+"]",v=RegExp("^"+f+f+"*"),m=RegExp(f+f+"*$"),h=function(e){return function(t){var r=c(o(t));return 1&e&&(r=l(r,v,"")),2&e&&(r=l(r,m,"")),r}};e.exports={start:h(1),end:h(2),trim:h(3)}},363:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},364:function(e,t,r){var content=r(368);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("844369e8",content,!0,{sourceMap:!1})},365:function(e,t,r){var content=r(370);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("66a90620",content,!0,{sourceMap:!1})},367:function(e,t,r){"use strict";r(364)},368:function(e,t,r){var n=r(18)(!1);n.push([e.i,".response--wrapper[data-v-5d37a5b8]{padding:1rem 0}.response--header[data-v-5d37a5b8]{display:flex;align-items:center}.response--author[data-v-5d37a5b8]{font-weight:700;margin-right:1rem}ul[data-v-5d37a5b8]{list-style-type:none;padding:0;margin:.5rem 0 0}ul li[data-v-5d37a5b8]{margin-bottom:.5rem}ul a[data-v-5d37a5b8]{font-weight:700}",""]),e.exports=n},369:function(e,t,r){"use strict";r(365)},370:function(e,t,r){var n=r(18)(!1);n.push([e.i,'form[data-v-70b3e09c]{margin:3rem 0;padding:1rem;border:1px solid #ccc;border-radius:3px}input[data-v-70b3e09c]{background-color:transparent;border:none;box-shadow:none;padding:.5rem;font-size:1rem;font-family:"Roboto",sans-serif;width:100%;margin-bottom:1rem}input[data-v-70b3e09c]:focus{border-color:#e61400;outline:0}input[type=submit][data-v-70b3e09c]{background:#ff5140;color:#fff;transition:background .25s ease;border-radius:3px;border:none;margin:0;padding:.75rem 1rem;text-align:center;font-weight:700;font-size:1rem;cursor:pointer}input[type=submit][data-v-70b3e09c]:focus,input[type=submit][data-v-70b3e09c]:hover{background:#e61400}.box--actions[data-v-70b3e09c],.box--bottom[data-v-70b3e09c]{display:flex;justify-content:space-between;align-items:center}.request-status[data-v-70b3e09c]{display:flex;margin-right:1rem}.request-status label[data-v-70b3e09c]{display:inline-block;margin-right:.5rem}',""]),e.exports=n},375:function(e,t,r){"use strict";r.r(t);var n={props:{response:{type:Object,required:!0},userId:{type:String,required:!0},isAgent:{type:Boolean,default:!1}},computed:{resAuthor:function(){return this.isAgent?this.response.userId===this.userId?"Vous":"Utilisateur":this.response.userId===this.userId?"Vous":"Agent"},resAttachments:function(){var e=this.response.resAttachments.split(";");return e.pop(),e}},methods:{extractFilename:function(e){return e.split("/").pop()}}},o=(r(367),r(8)),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"response--wrapper"},[t("div",{staticClass:"response--header"},[t("h3",{staticClass:"response--author"},[e._v(e._s(e.resAuthor))]),e._v(" "),t("div",{staticClass:"response--date"},[e._v(e._s(new Date(e.response.resSendDate).toLocaleDateString()))])]),e._v(" "),t("p",{staticClass:"response--content"},[e._v(e._s(e.response.resContent))]),e._v(" "),e.resAttachments.length>0?t("ul",e._l(e.resAttachments,(function(r,n){return t("li",{key:n},[t("a",{attrs:{href:r}},[e._v(e._s(e.extractFilename(r)))])])})),0):e._e()])}),[],!1,null,"5d37a5b8",null);t.default=component.exports},376:function(e,t,r){"use strict";r.r(t);r(57),r(30),r(11),r(49),r(38),r(51),r(39),r(33),r(24),r(52),r(53),r(40);var n=r(9);r(48),r(360);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){l=!0,o=e},f:function(){try{d||null==r.return||r.return()}finally{if(l)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var d={props:{reqId:{type:String,required:!0},reqStatusId:{type:Number,required:!0},token:{type:String,required:!0},isAgent:{type:Boolean,default:!1}},data:function(){return{resContent:"",resAttachments:[],requestStatus:[],requestStatusId:this.reqStatusId}},fetch:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.$get("/requests/status");case 2:e.requestStatus=t.sent;case 3:case"end":return t.stop()}}),t)})))()},methods:{handleFileUpload:function(e){var t=e.target.files||e.dataTransfer.files;t.length&&(this.resAttachments=t)},sendResponse:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,data,n,c,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new FormData,data={reqId:e.reqId,resContent:e.resContent},r.append("data",JSON.stringify(data)),n=o(e.resAttachments);try{for(n.s();!(c=n.n()).done;)d=c.value,r.append("attachements",d)}catch(e){n.e(e)}finally{n.f()}return t.prev=5,l={"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e.token)},t.next=9,e.$axios.$post("/responses",r,{headers:l});case 9:if(!e.isAgent||e.requestStatusId===e.reqStatusId){t.next=12;break}return t.next=12,e.$axios.$post("/requests/".concat(e.reqId,"/update"),{reqId:e.reqId,reqStatusId:e.requestStatusId},{headers:{Authorization:"Bearer ".concat(e.token)}});case 12:e.resContent="",e.resAttachments=[],e.$emit("responsesent"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),e.$emit("responsesent",t.t0);case 20:case"end":return t.stop()}}),t,null,[[5,17]])})))()}}},l=(r(369),r(8)),component=Object(l.a)(d,(function(){var e=this,t=e._self._c;return t("form",{on:{submit:function(t){return t.preventDefault(),e.sendResponse()}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.resContent,expression:"resContent"}],attrs:{type:"text",placeholder:"Ecrire une message...",required:""},domProps:{value:e.resContent},on:{input:function(t){t.target.composing||(e.resContent=t.target.value)}}}),e._v(" "),t("div",{staticClass:"box--bottom"},[t("div",[t("input",{attrs:{id:"attachements",type:"file",name:"attachements",multiple:""},on:{change:e.handleFileUpload}})]),e._v(" "),t("div",{staticClass:"box--actions"},[e.isAgent?t("div",{staticClass:"request-status"},[t("label",{attrs:{for:"request-status"}},[e._v("Statut requête")]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model.number",value:e.requestStatusId,expression:"requestStatusId",modifiers:{number:!0}}],attrs:{id:"request-status"},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(t){var r="_value"in t?t._value:t.value;return e._n(r)}));e.requestStatusId=t.target.multiple?r:r[0]}}},e._l(e.requestStatus,(function(r){return t("option",{key:r.reqStatusId,domProps:{value:r.reqStatusId}},[e._v("\n            "+e._s(r.reqStatusLabel)+"\n          ")])})),0)]):e._e(),e._v(" "),t("input",{attrs:{type:"submit",value:"Envoyer"}})])])])}),[],!1,null,"70b3e09c",null);t.default=component.exports},402:function(e,t,r){var content=r(438);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("488afe12",content,!0,{sourceMap:!1})},437:function(e,t,r){"use strict";r(402)},438:function(e,t,r){var n=r(18)(!1);n.push([e.i,'section[data-v-644d5d32]{padding:6rem 0;width:100%}.wrapper[data-v-644d5d32]{width:600px;margin:auto}h2[data-v-644d5d32]{font-family:"Barlow Condensed",sans-serif;font-size:2rem;margin:2rem 0 1rem}a[data-v-644d5d32],h2[data-v-644d5d32],tr td[data-v-644d5d32]:first-child{font-weight:700}',""]),e.exports=n},459:function(e,t,r){"use strict";r.r(t);var n=r(9),o=(r(48),r(216),r(11),{asyncData:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,d,l,f,v,m,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.params,n=e.$axios,o=e.store,c=e.error,d=r.reqId,t.prev=2,l={Authorization:"Bearer ".concat(o.getters.token)},t.next=6,n.$get("/requests/".concat(d),{headers:l});case 6:return f=t.sent,t.next=9,n.$get("/requests/".concat(d,"/responses"),{headers:l});case 9:return v=t.sent,t.next=12,n.$get("/requests/types");case 12:return m=t.sent,t.next=15,n.$get("/requests/status");case 15:return h=t.sent,t.abrupt("return",{userId:o.state.user.id,token:o.getters.token,request:f,responses:v,reqTypeLabel:m.find((function(e){return e.reqTypeId===f.reqTypeId})).reqTypeLabel,reqStatusLabel:h.find((function(e){return e.reqStatusId===f.reqStatusId})).reqStatusLabel});case 19:return t.prev=19,t.t0=t.catch(2),t.abrupt("return",c(t.t0));case 22:case"end":return t.stop()}}),t,null,[[2,19]])})))()},head:function(){return{title:"Requête #".concat(this.request.reqId," — eCollectivités")}},computed:{reqAttachments:function(){var e=this.request.reqAttachments.split(";");return e.pop(),e}},methods:{extractFilename:function(e){return e.split("/").pop()},responsesent:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e){r.next=4;break}t.$toast.error("Une erreur est survenue. Veuillez réessayer plus tard."),r.next=9;break;case 4:return t.$toast.success("Réponse envoyée avec succès!"),n={Authorization:"Bearer ".concat(t.token)},r.next=8,t.$axios.$get("/requests/".concat(t.request.reqId,"/responses"),{headers:n});case 8:t.responses=r.sent;case 9:case"end":return r.stop()}}),r)})))()}}}),c=(r(437),r(8)),component=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("section",[t("div",{staticClass:"wrapper"},[t("nuxt-link",{attrs:{to:"/mon-compte/mes-requetes"}},[t("ion-icon",{attrs:{name:"arrow-back"}}),e._v(" "),t("span",[e._v(" Retourner ")])],1),e._v(" "),t("h1",[e._v(e._s(e.request.title))]),e._v(" "),t("table",[t("tr",[t("td",[e._v("ID")]),e._v(" "),t("td",[e._v(e._s(e.request.reqId))])]),e._v(" "),t("tr",[t("td",[e._v("Statut")]),e._v(" "),t("td",[e._v(e._s(e.reqStatusLabel))])]),e._v(" "),t("tr",[t("td",[e._v("Type de requête")]),e._v(" "),t("td",[e._v(e._s(e.reqTypeLabel))])]),e._v(" "),t("tr",[t("td",[e._v("Date de soumission")]),e._v(" "),t("td",[e._v(e._s(new Date(e.request.reqCreatedAt).toLocaleDateString()))])]),e._v(" "),null!=e.request.reqClosedAt?t("tr",[t("td",[e._v("Date de clôture")]),e._v(" "),t("td",[e._v(e._s(new Date(e.request.reqClosedAt).toLocaleDateString()))])]):e._e()]),e._v(" "),t("h2",[e._v("Détails")]),e._v(" "),t("p",[e._v(e._s(e.request.reqContent))]),e._v(" "),t("h2",[e._v("Fichiers")]),e._v(" "),e.reqAttachments.length>0?t("div",[t("ul",e._l(e.reqAttachments,(function(r,n){return t("li",{key:n},[t("a",{attrs:{href:r}},[e._v(e._s(e.extractFilename(r)))])])})),0)]):t("div",[t("p",[e._v("Aucun fichier")])]),e._v(" "),t("h2",[e._v("Réponses")]),e._v(" "),e.responses.length>0?t("div",e._l(e.responses,(function(r){return t("RequestResponse",{key:r.resId,attrs:{response:r,userId:e.userId}})})),1):t("div",[t("p",[e._v("Aucune reponse pour l'instant, revenez régulièrement pour voir si vous avez de nouvelles réponses...")])]),e._v(" "),t("RequestResponseBox",{attrs:{reqId:e.request.reqId,token:e.token},on:{responsesent:e.responsesent}})],1)])}),[],!1,null,"644d5d32",null);t.default=component.exports;installComponents(component,{RequestResponse:r(375).default,RequestResponseBox:r(376).default})}}]);